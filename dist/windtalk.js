var windtalk=function(t){"use strict";let e,n;const r={},a=t=>t.reduce((t,e)=>t?t[e]:t,e);async function s(t){const n=t.data;let s,o,c;if(s=n&&n.id)if((o=n.type)&&e){n.path=n.path||[];const e={id:s},r=a(n.path),c=a(n.path.slice(0,-1));switch(o){case"G":e.value=r;break;case"S":const t=n.path.length&&n.path.pop();t&&(c[t]=n.value);break;case"A":try{e.value=await r.apply(c,n.args||[])}catch(t){e.error=t.toString()}}t.source.postMessage(e,"*")}else(c=r[s])&&(delete r[s],n.error?c[1](new Error(n.error)):c[0](n.value))}function o(){n||(self.addEventListener("message",s),n=!0)}return t.link=function(t){return function t(e,n){return n=n||[],new Proxy(function(){},{get(r,a,s){if("then"===a){if(0===n.length)return{then:()=>s};const t=e({type:"G",path:n});return t.then.bind(t)}return t(e,n.concat(a))},set:(t,r,a)=>e({type:"S",path:n.concat(r),value:a}),apply:(t,r,a)=>e({type:"A",path:n,args:a})})}(function(t){const e=`${Date.now()}-${Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}`;let n=0;return o(),a=>{const s=a.args||[],o=`${e}-${++n}`;return new Promise((e,n)=>{r[o]=[e,n],t.postMessage(Object.assign({},a,{id:o,args:s}),"*")})}}(t))},t.expose=function(t){e=t,o()},t}({});
