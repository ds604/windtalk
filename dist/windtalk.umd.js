!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).windtalk={})}(this,function(e){"use strict";let t,n;const r={},a=e=>e.reduce((e,t)=>e?e[t]:e,t);async function o(e){const n=e.data;let o,s,c;if(o=n&&n.id)if((s=n.type)&&t){n.path=n.path||[];const t={id:o},r=a(n.path),c=a(n.path.slice(0,-1));switch(s){case"G":t.value=r;break;case"S":const e=n.path.length&&n.path.pop();e&&(c[e]=n.value);break;case"A":try{t.value=await r.apply(c,n.args||[])}catch(e){t.error=e.toString()}}e.source.postMessage(t,"*")}else(c=r[o])&&(delete r[o],n.error?c[1](new Error(n.error)):c[0](n.value))}function s(){n||(self.addEventListener("message",o),n=!0)}e.expose=function(e){t=e,s()},e.link=function(e){return function e(t,n){return n=n||[],new Proxy(function(){},{get(r,a,o){if("then"===a){if(0===n.length)return{then:()=>o};const e=t({type:"G",path:n});return e.then.bind(e)}return e(t,n.concat(a))},set:(e,r,a)=>t({type:"S",path:n.concat(r),value:a}),apply:(e,r,a)=>t({type:"A",path:n,args:a})})}(function(e){const t=`${Date.now()}-${Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}`;let n=0;return s(),a=>{const o=a.args||[],s=`${t}-${++n}`;return new Promise((t,n)=>{r[s]=[t,n],e.postMessage(Object.assign({},a,{id:s,args:o}),"*")})}}(e))},Object.defineProperty(e,"__esModule",{value:!0})});
